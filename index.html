
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moments of Gratitude</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Crimson+Text:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    
    <!-- Upgrade Package Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIk1vbWVudHMgb2YgR3JhdGl0dWRlIiwKICAic2hvcnRfbmFtZSI6ICJHcmF0aXR1ZGUiLAogICJkZXNjcmlwdGlvbiI6ICJEYWlseSBncmF0aXR1ZGUgcHJhY3RpY2UgYXBwIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJ0aGVtZV9jb2xvciI6ICIjNjM2NjZmIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjZjNmNGY2IiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWNpSUhacFpYZENiM2c5SWpBZ01DQXlOREFnTWpRd0lpQm1hV3hzUFNJalptWm1abVlpUGp4amFYSmpiR1VnWTNnOUlqRXlNQ0lnWTNrOUlqRXlNQ0lnY2owaU9UWWlJR1pwYkd3OUlpTmpabVptWmlJdlBqd3ZjM1puUGc9PSIsCiAgICAgICJzaXplcyI6ICIyNDB4MjQwIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICBdCn0=">
    <meta name="theme-color" content="#63666f">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .quote-text {
            font-family: 'Crimson Text', serif;
            font-style: italic;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .smooth-transition {
            transition: all 0.3s ease-in-out;
        }
        .bell-animation {
            animation: bellRing 0.6s ease-in-out;
        }
        @keyframes bellRing {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        .fade-out {
            animation: fadeOut 0.3s ease-in-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .time-input {
            appearance: none;
            -webkit-appearance: none;
        }
        .note-item {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .sound-pulse {
            animation: soundPulse 2s infinite;
        }
        @keyframes soundPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        /* Upgrade Package Styles */
        .emoji-picker-container {
            display: none;
            position: relative;
        }
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            padding: 12px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-height: 200px;
            overflow-y: auto;
        }
        .emoji-btn {
            padding: 8px;
            border: none;
            background: none;
            font-size: 20px;
            cursor: pointer;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        .emoji-btn:hover {
            background-color: #f3f4f6;
        }
        .sentiment-slider {
            width: 100%;
            height: 40px;
            border-radius: 20px;
            background: linear-gradient(to right, #ef4444, #f59e0b, #10b981);
            appearance: none;
            outline: none;
        }
        .sentiment-slider::-webkit-slider-thumb {
            appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        .streak-display {
            text-align: center;
            padding: 20px;
        }
        .streak-number {
            font-size: 3rem;
            font-weight: bold;
            color: #10b981;
        }
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }
        .gallery-item {
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .sound-preview-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            background: #3b82f6;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
        }
        .volume-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            appearance: none;
            outline: none;
        }
        .volume-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }
        .locked-feature {
            opacity: 0.5;
            pointer-events: none;
        }
        
        /* Modal Close Button */
        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #6b7280;
            transition: all 0.2s;
        }
        .modal-close:hover {
            background: rgba(0, 0, 0, 0.2);
            color: #374151;
        }

        /* Gentle Confirmation Modal Styles */
        .confirmation-modal {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Delete Button Styles */
        .delete-btn {
            opacity: 0.6;
            transition: all 0.2s ease;
        }
        .delete-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        /* Upgrade Modal Styles */
        .upgrade-modal {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .feature-item {
            background: rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease;
        }
        .feature-item:hover {
            background: rgba(255, 255, 255, 0.6);
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen">

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        
        <!-- Opening Section -->
        <section id="opening" class="text-center mb-16">
            <div class="glass-card rounded-3xl p-12 shadow-2xl mb-8">
                <h1 class="text-5xl font-semibold gradient-text mb-6 tracking-tight">
                    Pause. Reflect. Appreciate.
                </h1>
                <p class="text-lg text-gray-600 mb-8 leading-relaxed max-w-2xl mx-auto">
                    Take a moment each day to acknowledge the good in your life. Small gratitude practices can lead to big changes in happiness and well-being.
                </p>
                
                <!-- Upgraded Quote Section -->
                <div id="quoteSection" class="bg-white bg-opacity-40 rounded-xl p-6 mb-8">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <p id="currentQuote" class="quote-text text-xl text-gray-700 font-medium">
                                "Gratitude turns what we have into enough."
                            </p>
                            <p id="currentAuthor" class="text-gray-500 mt-2">— Aesop</p>
                        </div>
                        <div id="quoteControls" class="flex gap-2" style="display: none;">
                            <button onclick="toggleFavoriteQuote()" id="favoriteBtn" class="text-yellow-500 hover:text-yellow-600 p-2">
                                <i class="far fa-star"></i>
                            </button>
                            <button onclick="shuffleQuote()" class="text-blue-500 hover:text-blue-600 p-2">
                                <i class="fas fa-random"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Streak Tracker (Upgrade Feature) -->
                <div id="streakTracker" class="bg-white bg-opacity-40 rounded-xl p-6 mb-8" style="display: none;">
                    <div class="streak-display">
                        <div class="streak-number" id="streakNumber">0</div>
                        <p class="text-gray-600">Day streak</p>
                        <p id="streakMessage" class="text-sm text-gray-500 mt-2">Start your gratitude journey today!</p>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button onclick="scrollToReminders()" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-full smooth-transition shadow-lg">
                        <i class="fas fa-bell mr-2"></i>Set Reminders
                    </button>
                    <button onclick="scrollToNotes()" class="bg-purple-500 hover:bg-purple-600 text-white px-8 py-3 rounded-full smooth-transition shadow-lg">
                        <i class="fas fa-heart mr-2"></i>Review Past Reflections
                    </button>
                </div>
            </div>
        </section>

        <!-- Reminder Section -->
        <section id="reminders" class="mb-16">
            <div class="glass-card rounded-3xl p-10 shadow-xl">
                <h2 class="text-3xl font-semibold text-gray-800 mb-8 text-center">
                    <i class="fas fa-clock text-blue-500 mr-3"></i>Daily Reminders
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="space-y-4">
                        <label class="block text-gray-700 font-medium">Reminder Times</label>
                        <div id="timeInputs" class="space-y-3">
                            <input type="time" class="time-input w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-400 focus:outline-none smooth-transition">
                            <input type="time" class="time-input w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-400 focus:outline-none smooth-transition">
                            <input type="time" class="time-input w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-400 focus:outline-none smooth-transition">
                            <input type="time" class="time-input w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-400 focus:outline-none smooth-transition">
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <label class="block text-gray-700 font-medium">Alert Settings</label>
                        <div class="flex items-center justify-between bg-white bg-opacity-50 rounded-xl p-4">
                            <span class="text-gray-700">Enable Notifications</span>
                            <button id="alertToggle" onclick="handleReminderToggle()" class="bg-gray-300 w-16 h-8 rounded-full relative smooth-transition">
                                <div id="toggleSlider" class="bg-white w-6 h-6 rounded-full absolute top-1 left-1 smooth-transition shadow-md"></div>
                            </button>
                        </div>
                        <div class="flex items-center justify-between bg-white bg-opacity-50 rounded-xl p-4">
                            <div class="flex items-center">
                                <i id="soundIcon" class="fas fa-bell text-gray-500 mr-2 smooth-transition"></i>
                                <span class="text-gray-700">Enable Sound</span>
                            </div>
                            <button id="soundToggle" onclick="toggleSound()" class="bg-gray-300 w-16 h-8 rounded-full relative smooth-transition">
                                <div id="soundSlider" class="bg-white w-6 h-6 rounded-full absolute top-1 left-1 smooth-transition shadow-md"></div>
                            </button>
                        </div>
                        
                        <!-- Volume Control -->
                        <div id="volumeControl" class="bg-white bg-opacity-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <label class="text-gray-700 font-medium">Volume</label>
                                <span id="volumeValue" class="text-sm text-gray-500">50%</span>
                            </div>
                            <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="50" onchange="updateVolume(this.value)">
                        </div>
                        
                        <!-- Cloud Sync (Upgrade Feature) -->
                        <div id="cloudSync" class="bg-white bg-opacity-50 rounded-xl p-4" style="display: none;">
                            <div class="flex items-center justify-between mb-3">
                                <span class="text-gray-700 font-medium">Cloud Sync</span>
                                <button id="syncToggle" onclick="toggleCloudSync()" class="bg-gray-300 w-12 h-6 rounded-full relative smooth-transition">
                                    <div id="syncSlider" class="bg-white w-4 h-4 rounded-full absolute top-1 left-1 smooth-transition shadow-md"></div>
                                </button>
                            </div>
                            <p class="text-sm text-gray-500 mb-2">Sync your gratitude across devices</p>
                            <div id="syncStatus" class="text-xs text-gray-400">Not connected</div>
                        </div>
                    </div>
                </div>
                
                <!-- Centered Save Button -->
                <div class="flex justify-center">
                    <button id="saveRemindersBtn" onclick="saveReminders()" class="bg-green-500 hover:bg-green-600 text-white py-3 px-8 rounded-xl smooth-transition shadow-lg">
                        <i class="fas fa-save mr-2"></i>Save Reminders
                    </button>
                </div>
            </div>
        </section>

        <!-- Learn More Upgrade Section -->
        <section id="learnMoreSection" class="mb-16">
            <div class="glass-card rounded-3xl p-8 shadow-xl text-center">
                <div class="mb-6">
                    <i class="fas fa-seedling text-4xl text-green-500 mb-4"></i>
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">Ready to deepen your practice?</h3>
                    <p class="text-gray-600 leading-relaxed max-w-2xl mx-auto">
                        Unlock gentle upgrades that grow with you. Experience enhanced features designed to nurture your gratitude journey with compassionate tools and deeper insights.
                    </p>
                </div>
                
                <button onclick="showUpgradeModal()" class="inline-flex items-center bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-xl smooth-transition shadow-lg font-medium">
                    <i class="fas fa-arrow-right mr-2"></i>
                    Learn More
                </button>
            </div>
        </section>

        <!-- Notes Section -->
        <section id="notes" class="mb-16">
            <div class="glass-card rounded-3xl p-10 shadow-xl">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-semibold text-gray-800">
                        <i class="fas fa-folder text-purple-500 mr-3"></i>My Gratitude Notes
                    </h2>
                    <div class="flex gap-3">
                        <!-- Export/Import Controls (Upgrade Feature) -->
                        <div id="exportImportControls" class="flex gap-2" style="display: none;">
                            <button onclick="exportToPDF()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg smooth-transition text-sm">
                                <i class="fas fa-file-pdf mr-1"></i>PDF
                            </button>
                            <label class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg smooth-transition text-sm cursor-pointer">
                                <i class="fas fa-upload mr-1"></i>Import
                                <input type="file" accept=".json" onchange="importNotes(this)" class="hidden">
                            </label>
                        </div>
                        <button onclick="toggleNotesFolder()" id="folderToggle" class="bg-purple-100 hover:bg-purple-200 text-purple-700 px-4 py-2 rounded-lg smooth-transition">
                            <i class="fas fa-chevron-down" id="folderIcon"></i>
                        </button>
                    </div>
                </div>
                
                <div id="notesFolder" class="space-y-4 max-h-96 overflow-y-auto">
                    <div id="notesList" class="space-y-3"></div>
                    
                    <!-- Clear All Notes Button -->
                    <div id="clearAllContainer" class="pt-4 border-t border-gray-200 text-center" style="display: none;">
                        <button onclick="confirmClearAllNotes()" class="bg-red-100 hover:bg-red-200 text-red-700 px-6 py-2 rounded-lg smooth-transition text-sm">
                            <i class="fas fa-trash-alt mr-2"></i>Clear All Notes
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Gratitude Gallery (Upgrade Feature) -->
        <section id="gratitudeGallery" class="mb-16" style="display: none;">
            <div class="glass-card rounded-3xl p-10 shadow-xl">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-semibold text-gray-800">
                        <i class="fas fa-images text-pink-500 mr-3"></i>Gratitude Gallery
                    </h2>
                </div>
                <p class="text-gray-600 mb-6">A visual collection of your most meaningful gratitude moments</p>
                <div id="galleryGrid" class="gallery-grid">
                    <!-- Gallery items will be populated here -->
                </div>
            </div>
        </section>

        <!-- Streak Analytics (Upgrade Feature) -->
        <section id="streakAnalytics" class="mb-16" style="display: none;">
            <div class="glass-card rounded-3xl p-10 shadow-xl">
                <h2 class="text-3xl font-semibold text-gray-800 mb-8 text-center">
                    <i class="fas fa-chart-line text-green-500 mr-3"></i>Your Gratitude Journey
                </h2>
                <div style="height: 400px; position: relative;">
                    <canvas id="streakChart"></canvas>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="mb-8">
            <div class="glass-card rounded-3xl p-10 shadow-xl">
                <h2 class="text-3xl font-semibold text-gray-800 mb-8">
                    <i class="fas fa-info-circle text-indigo-500 mr-3"></i>What is Moments of Gratitude?
                </h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <p class="text-gray-700 leading-relaxed mb-6">
                            Moments of Gratitude is designed to help you cultivate a daily gratitude practice. Research shows that regularly acknowledging the positive aspects of life can:
                        </p>
                        <ul class="space-y-2 text-gray-700">
                            <li class="flex items-start">
                                <i class="fas fa-heart text-pink-500 mt-1 mr-3"></i>
                                <span>Increase happiness and life satisfaction</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-leaf text-green-500 mt-1 mr-3"></i>
                                <span>Reduce stress and anxiety</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-moon text-blue-500 mt-1 mr-3"></i>
                                <span>Improve sleep quality</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-users text-orange-500 mt-1 mr-3"></i>
                                <span>Strengthen relationships</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-shield-alt text-purple-500 mt-1 mr-3"></i>
                                <span>Enhance resilience during difficult times</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">
                            <i class="fas fa-compass text-teal-500 mr-2"></i>How to Use Moments of Gratitude
                        </h3>
                        <div class="space-y-4 text-gray-700">
                            <div class="flex items-start">
                                <span class="bg-blue-100 text-blue-800 rounded-full w-8 h-8 flex items-center justify-center text-sm font-semibold mr-3 mt-0.5">1</span>
                                <span>Set your preferred reminder times</span>
                            </div>
                            <div class="flex items-start">
                                <span class="bg-purple-100 text-purple-800 rounded-full w-8 h-8 flex items-center justify-center text-sm font-semibold mr-3 mt-0.5">2</span>
                                <span>When a reminder appears, take 30 seconds to reflect</span>
                            </div>
                            <div class="flex items-start">
                                <span class="bg-green-100 text-green-800 rounded-full w-8 h-8 flex items-center justify-center text-sm font-semibold mr-3 mt-0.5">3</span>
                                <span>Optionally jot down your thoughts in the journal</span>
                            </div>
                            <div class="flex items-start">
                                <span class="bg-orange-100 text-orange-800 rounded-full w-8 h-8 flex items-center justify-center text-sm font-semibold mr-3 mt-0.5">4</span>
                                <span>Review past entries when you need a positivity boost</span>
                            </div>
                        </div>
                        <div class="mt-6 p-4 bg-blue-50 rounded-xl">
                            <p class="text-sm text-gray-600">
                                <i class="fas fa-lock text-blue-500 mr-2"></i>
                                All your data is stored locally in your browser — nothing is sent to any servers. This is your personal gratitude space.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Quick Note Modal -->
    <div id="quickNoteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4" onclick="handleModalBackdropClick(event, 'quickNoteModal')">
        <div class="glass-card rounded-2xl p-8 max-w-md w-full mx-auto fade-in relative" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeQuickNote()">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="text-center mb-6">
                <i class="fas fa-bell bell-animation text-4xl text-yellow-500 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-800 mb-2">Moment of Gratitude</h3>
                <p class="text-gray-600">What are you grateful for right now?</p>
            </div>
            
            <!-- Sentiment Slider (Upgrade Feature) -->
            <div id="sentimentSection" class="mb-4" style="display: none;">
                <label class="block text-sm text-gray-600 mb-2">How are you feeling?</label>
                <div class="flex items-center gap-3">
                    <span class="text-2xl">😞</span>
                    <input type="range" id="sentimentSlider" class="sentiment-slider flex-1" min="1" max="5" value="3">
                    <span class="text-2xl">😊</span>
                </div>
                <div class="text-center mt-2">
                    <span id="sentimentLabel" class="text-sm text-gray-500">Neutral</span>
                </div>
            </div>
            
            <div class="relative">
                <textarea id="quickNoteText" placeholder="I'm grateful for..." class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-blue-400 focus:outline-none smooth-transition resize-none" rows="4"></textarea>
                
                <!-- Emoji Picker (Upgrade Feature) -->
                <div id="emojiPickerContainer" class="emoji-picker-container absolute bottom-2 right-2">
                    <button onclick="toggleEmojiPicker()" class="text-gray-400 hover:text-gray-600 p-2">
                        <i class="fas fa-smile text-xl"></i>
                    </button>
                    <div id="emojiPicker" class="emoji-grid absolute bottom-full right-0 mb-2" style="display: none;">
                        <!-- Emoji grid will be populated here -->
                    </div>
                </div>
            </div>
            
            <!-- Image Attachment (Upgrade Feature) -->
            <div id="imageAttachment" class="mt-4" style="display: none;">
                <label class="flex items-center cursor-pointer text-gray-600 hover:text-gray-800">
                    <i class="fas fa-camera mr-2"></i>
                    <span class="text-sm">Add a photo to this moment</span>
                    <input type="file" accept="image/*" onchange="attachImage(this)" class="hidden">
                </label>
                <div id="attachedImagePreview" class="mt-2" style="display: none;">
                    <img id="attachedImage" class="w-20 h-20 object-cover rounded-lg">
                    <button onclick="removeAttachedImage()" class="ml-2 text-red-500 hover:text-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="flex gap-3 mt-6">
                <button onclick="saveQuickNote()" id="saveQuickNoteBtn" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl smooth-transition">
                    <i class="fas fa-save mr-2"></i>Save
                </button>
                <button onclick="closeQuickNote()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-xl smooth-transition">
                    Skip
                </button>
            </div>
        </div>
    </div>

    <!-- Upgrade Modal -->
    <div id="upgradeModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4" onclick="handleModalBackdropClick(event, 'upgradeModal')">
        <div class="upgrade-modal rounded-3xl p-8 max-w-lg w-full mx-auto fade-in relative shadow-2xl" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeUpgradeModal()">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="text-center mb-8">
                <i class="fas fa-star text-5xl text-yellow-500 mb-4"></i>
                <h3 class="text-2xl font-semibold text-gray-800 mb-3">Gentle Upgrades Await</h3>
                <p class="text-gray-600 leading-relaxed">
                    Discover thoughtful enhancements designed to deepen your gratitude practice with compassion and mindfulness.
                </p>
            </div>
            
            <div class="space-y-4 mb-8">
                <div class="feature-item rounded-xl p-4">
                    <div class="flex items-start">
                        <i class="fas fa-chart-line text-green-500 text-xl mr-3 mt-1"></i>
                        <div>
                            <h4 class="font-medium text-gray-800">Progress Tracking</h4>
                            <p class="text-sm text-gray-600 mt-1">Gentle streak tracking and beautiful analytics to celebrate your journey without pressure.</p>
                        </div>
                    </div>
                </div>
                
                <div class="feature-item rounded-xl p-4">
                    <div class="flex items-start">
                        <i class="fas fa-palette text-purple-500 text-xl mr-3 mt-1"></i>
                        <div>
                            <h4 class="font-medium text-gray-800">Rich Expression</h4>
                            <p class="text-sm text-gray-600 mt-1">Add photos, emojis, and mood tracking to capture the full spectrum of your grateful moments.</p>
                        </div>
                    </div>
                </div>
                
                <div class="feature-item rounded-xl p-4">
                    <div class="flex items-start">
                        <i class="fas fa-cloud text-blue-500 text-xl mr-3 mt-1"></i>
                        <div>
                            <h4 class="font-medium text-gray-800">Seamless Sync</h4>
                            <p class="text-sm text-gray-600 mt-1">Access your reflections across all your devices with secure cloud synchronization.</p>
                        </div>
                    </div>
                </div>
                
                <div class="feature-item rounded-xl p-4">
                    <div class="flex items-start">
                        <i class="fas fa-heart text-pink-500 text-xl mr-3 mt-1"></i>
                        <div>
                            <h4 class="font-medium text-gray-800">Mindful Insights</h4>
                            <p class="text-sm text-gray-600 mt-1">Curated quotes, guided prompts, and gentle nudges to inspire deeper reflection.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="space-y-3">
                <button disabled class="w-full bg-gray-300 text-gray-500 py-3 px-6 rounded-xl font-medium cursor-not-allowed">
                    <i class="fas fa-lock mr-2"></i>Yes, I'm in (Coming Soon)
                </button>
                <button onclick="maybeLater()" class="w-full bg-blue-100 hover:bg-blue-200 text-blue-700 py-3 px-6 rounded-xl smooth-transition font-medium">
                    <i class="fas fa-clock mr-2"></i>Maybe Later
                </button>
            </div>
        </div>
    </div>

    <!-- Gentle Confirmation Modal -->
    <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-30 hidden items-center justify-center z-60 p-4">
        <div class="confirmation-modal rounded-2xl p-8 max-w-md w-full mx-auto fade-in relative shadow-2xl">
            <div class="text-center">
                <i id="confirmationIcon" class="fas fa-question-circle text-4xl text-amber-500 mb-4"></i>
                <h3 id="confirmationTitle" class="text-xl font-semibold text-gray-800 mb-3">Confirm Action</h3>
                <p id="confirmationMessage" class="text-gray-600 mb-6 leading-relaxed">Are you sure you want to proceed?</p>
                
                <div class="flex gap-3">
                    <button id="confirmationCancel" onclick="closeConfirmationModal()" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-xl smooth-transition">
                        Cancel
                    </button>
                    <button id="confirmationConfirm" class="flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded-xl smooth-transition">
                        Confirm
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // App State
        let alertsEnabled = false;
        let soundEnabled = false;
        let upgradeEnabled = false;
        let reminderTimes = [];
        let reminderIntervals = [];
        let notesVisible = false;
        let audioContext;
        let selectedNotes = new Set();
        let lastSoundTime = 0;
        let upgradeOptInShown = false;
        let currentVolume = 0.5;
        let currentSoundInstance = null;
        let soundTimeout = null;

        // Upgrade Package State
        let currentStreak = 0;
        let lastGratitudeDate = null;
        let cloudSyncEnabled = false;
        let currentQuoteIndex = 0;
        let favoriteQuotes = new Set();
        let attachedImageData = null;
        let customSounds = {};
        let selectedReminderSound = 'default';
        
        // Quotes database
        const quotes = [
            { text: "Gratitude turns what we have into enough.", author: "Aesop" },
            { text: "Be thankful for what you have; you'll end up having more.", author: "Oprah Winfrey" },
            { text: "Gratitude is not only the greatest of virtues but the parent of all others.", author: "Cicero" },
            { text: "The unthankful heart discovers no mercies; but the thankful heart will find, in every hour, some heavenly blessings.", author: "Henry Ward Beecher" },
            { text: "Gratitude makes sense of our past, brings peace for today, and creates a vision for tomorrow.", author: "Melody Beattie" },
            { text: "In ordinary life, we hardly realize that we receive a great deal more than we give, and that it is only with gratitude that life becomes rich.", author: "Dietrich Bonhoeffer" }
        ];

        // Emoji sets for picker
        const emojiSets = {
            faces: ['😊', '😍', '🥰', '😘', '😂', '🤗', '🙂', '😌', '😋', '😎', '🤩', '🥳', '😇', '🤠', '🥺', '😉'],
            hearts: ['❤️', '💕', '💖', '💗', '💓', '💝', '💜', '🧡', '💛', '💚', '💙', '🤍', '🤎', '💔', '❣️', '💟'],
            nature: ['🌸', '🌺', '🌻', '🌷', '🌹', '🌿', '🌱', '🌳', '🌲', '🌴', '🌵', '🌾', '🍀', '🌼', '🌵', '🌊']
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            loadNotes();
            displayNotes();
            loadUpgradeState();
            
            // Initialize audio context on first user interaction
            document.addEventListener('click', initAudioContext, { once: true });
            document.addEventListener('touchstart', initAudioContext, { once: true });
            
            // Add keyboard support for modals and stopping sounds
            document.addEventListener('keydown', function(e) {
                // Stop sound on any key press
                if (currentSoundInstance || soundTimeout) {
                    stopCurrentSound();
                }
                
                if (e.key === 'Escape') {
                    // Close any open modals
                    if (!document.getElementById('quickNoteModal').classList.contains('hidden')) {
                        closeQuickNote();
                    }
                    if (!document.getElementById('confirmationModal').classList.contains('hidden')) {
                        closeConfirmationModal();
                    }
                    if (!document.getElementById('upgradeModal').classList.contains('hidden')) {
                        closeUpgradeModal();
                    }
                }
            });
        });

        // UPGRADE MODAL FUNCTIONS
        function showUpgradeModal() {
            const modal = document.getElementById('upgradeModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeUpgradeModal() {
            const modal = document.getElementById('upgradeModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function maybeLater() {
            closeUpgradeModal();
            // Smooth scroll to reminders section
            document.getElementById('reminders').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        // MODAL BACKDROP CLICK HANDLER
        function handleModalBackdropClick(event, modalId) {
            if (event.target.id === modalId) {
                switch(modalId) {
                    case 'quickNoteModal':
                        closeQuickNote();
                        break;
                    case 'upgradeModal':
                        closeUpgradeModal();
                        break;
                }
            }
        }

        // ENHANCED SOUND SYSTEM WITH 12-SECOND MAX AND KEY STOP
        function stopCurrentSound() {
            if (currentSoundInstance) {
                try {
                    currentSoundInstance.pause();
                    currentSoundInstance.currentTime = 0;
                } catch (e) {
                    console.log('Sound already stopped');
                }
                currentSoundInstance = null;
            }
            
            if (soundTimeout) {
                clearTimeout(soundTimeout);
                soundTimeout = null;
            }
            
            // Stop Web Audio API sounds
            if (audioContext) {
                try {
                    audioContext.suspend();
                    setTimeout(() => {
                        if (audioContext) audioContext.resume();
                    }, 100);
                } catch (e) {
                    console.log('AudioContext suspend failed');
                }
            }
        }

        // CROSS-ENVIRONMENT AUDIO INITIALIZATION
        function initAudioContext() {
            try {
                if (!audioContext) {
                    // Use compatibility version for all browsers
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    if (AudioContext) {
                        audioContext = new AudioContext();
                    }
                }
                
                // Resume audio context if suspended (required for autoplay policy compliance)
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        console.log('Audio context resumed successfully');
                    }).catch(error => {
                        console.warn('Failed to resume audio context:', error);
                    });
                }
            } catch (error) {
                console.warn('AudioContext not supported, using HTML5 Audio fallback');
                audioContext = null;
            }
        }

        // GENTLE CONFIRMATION MODAL FUNCTIONS
        function showConfirmationModal(title, message, confirmCallback, icon = 'fa-question-circle', iconColor = 'text-amber-500') {
            const modal = document.getElementById('confirmationModal');
            const titleEl = document.getElementById('confirmationTitle');
            const messageEl = document.getElementById('confirmationMessage');
            const iconEl = document.getElementById('confirmationIcon');
            const confirmBtn = document.getElementById('confirmationConfirm');
            
            titleEl.textContent = title;
            messageEl.textContent = message;
            iconEl.className = `fas ${icon} text-4xl ${iconColor} mb-4`;
            
            // Clear previous event listeners
            confirmBtn.onclick = () => {
                confirmCallback();
                closeConfirmationModal();
            };
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeConfirmationModal() {
            const modal = document.getElementById('confirmationModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // REMINDER TOGGLE LOGIC
        function handleReminderToggle() {
            alertsEnabled = !alertsEnabled;
            const toggle = document.getElementById('alertToggle');
            const slider = document.getElementById('toggleSlider');
            
            if (alertsEnabled) {
                // Enable reminders
                toggle.classList.add('bg-blue-500');
                toggle.classList.remove('bg-gray-300');
                slider.style.transform = 'translateX(32px)';
                
                // Schedule reminders if times are set
                if (reminderTimes.length > 0) {
                    setupReminders();
                    console.log('Reminders enabled and scheduled for:', reminderTimes);
                }
            } else {
                // Disable reminders
                toggle.classList.add('bg-gray-300');
                toggle.classList.remove('bg-blue-500');
                slider.style.transform = 'translateX(0px)';
                
                // Clear all scheduled reminders
                clearAllReminders();
                console.log('Reminders disabled and unscheduled');
            }
            
            // Update sound toggle state based on alerts
            updateSoundToggleState();
            
            // Persist the state
            saveSettings();
            
            // Visual feedback
            const button = toggle;
            button.classList.add('ring-4', 'ring-blue-200');
            setTimeout(() => {
                button.classList.remove('ring-4', 'ring-blue-200');
            }, 300);
        }

        // UPGRADE PACKAGE IMPLEMENTATION
        
        function isFeatureUnlocked(featureName) {
            return upgradeEnabled;
        }

        function loadUpgradePackage() {
            console.log('Loading upgrade package features...');
            
            // Show upgrade features
            showUpgradeFeatures();
            
            // Initialize upgrade components
            initializeStreakTracker();
            initializeQuoteEnhancements();
            initializeEmojiPicker();
            initializeCloudSync();
            initializeGallery();
            initializeStreakChart();
            
            // Update UI components
            displayNotes();
            updateStreakDisplay();
        }

        function showUpgradeFeatures() {
            if (!isFeatureUnlocked()) return;
            
            // Show upgrade UI elements
            document.getElementById('streakTracker').style.display = 'block';
            document.getElementById('quoteControls').style.display = 'flex';
            document.getElementById('cloudSync').style.display = 'block';
            document.getElementById('exportImportControls').style.display = 'flex';
            document.getElementById('gratitudeGallery').style.display = 'block';
            document.getElementById('streakAnalytics').style.display = 'block';
            
            // Show upgrade elements in quick note modal
            document.getElementById('sentimentSection').style.display = 'block';
            document.getElementById('emojiPickerContainer').style.display = 'block';
            document.getElementById('imageAttachment').style.display = 'block';
        }

        function hideUpgradeFeatures() {
            // Hide upgrade UI elements
            document.getElementById('streakTracker').style.display = 'none';
            document.getElementById('quoteControls').style.display = 'none';
            document.getElementById('cloudSync').style.display = 'none';
            document.getElementById('exportImportControls').style.display = 'none';
            document.getElementById('gratitudeGallery').style.display = 'none';
            document.getElementById('streakAnalytics').style.display = 'none';
            
            // Hide upgrade elements in quick note modal
            document.getElementById('sentimentSection').style.display = 'none';
            document.getElementById('emojiPickerContainer').style.display = 'none';
            document.getElementById('imageAttachment').style.display = 'none';
        }

        // VOLUME CONTROL
        function updateVolume(value) {
            currentVolume = value / 100;
            document.getElementById('volumeValue').textContent = value + '%';
            localStorage.setItem('reminderVolume', value);
        }

        // ENHANCED CROSS-ENVIRONMENT SOUND SYSTEM WITH 12-SECOND MAX
        function createToneAudio(frequency, maxDuration, volume) {
            // Stop any existing sound
            stopCurrentSound();
            
            return new Promise((resolve, reject) => {
                const duration = Math.min(maxDuration, 12); // Max 12 seconds as requested
                
                // Method 1: Web Audio API (most reliable for programmatic sounds)
                if (audioContext && audioContext.state !== 'suspended') {
                    try {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(frequency * 0.7, audioContext.currentTime + duration * 0.3);
                        
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(volume * 0.3, audioContext.currentTime + 0.01);
                        gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                        
                        oscillator.type = 'sine';
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + duration);
                        
                        // Set timeout to stop after max duration
                        soundTimeout = setTimeout(() => {
                            stopCurrentSound();
                            resolve();
                        }, duration * 1000);
                        
                        oscillator.onended = () => {
                            stopCurrentSound();
                            resolve();
                        };
                        
                        return;
                    } catch (error) {
                        console.warn('Web Audio API failed:', error);
                    }
                }
                
                // Method 2: HTML5 Audio with data URI (fallback)
                try {
                    // Create a simple sine wave
                    const sampleRate = 22050; // Lower sample rate for smaller data
                    const samples = Math.floor(sampleRate * duration);
                    const buffer = new ArrayBuffer(44 + samples * 2);
                    const view = new DataView(buffer);
                    
                    // WAV header
                    const writeString = (offset, string) => {
                        for (let i = 0; i < string.length; i++) {
                            view.setUint8(offset + i, string.charCodeAt(i));
                        }
                    };
                    
                    writeString(0, 'RIFF');
                    view.setUint32(4, 36 + samples * 2, true);
                    writeString(8, 'WAVE');
                    writeString(12, 'fmt ');
                    view.setUint32(16, 16, true);
                    view.setUint16(20, 1, true);
                    view.setUint16(22, 1, true);
                    view.setUint32(24, sampleRate, true);
                    view.setUint32(28, sampleRate * 2, true);
                    view.setUint16(32, 2, true);
                    view.setUint16(34, 16, true);
                    writeString(36, 'data');
                    view.setUint32(40, samples * 2, true);
                    
                    // Generate sine wave with fade
                    for (let i = 0; i < samples; i++) {
                        const t = i / sampleRate;
                        const fadeIn = Math.min(t * 20, 1); // 50ms fade in
                        const fadeOut = Math.min((duration - t) * 20, 1); // 50ms fade out
                        const envelope = fadeIn * fadeOut;
                        const sample = Math.sin(2 * Math.PI * frequency * t) * volume * envelope * 0.3;
                        view.setInt16(44 + i * 2, sample * 32767, true);
                    }
                    
                    const blob = new Blob([buffer], { type: 'audio/wav' });
                    const audio = new Audio();
                    audio.src = URL.createObjectURL(blob);
                    audio.volume = volume;
                    
                    currentSoundInstance = audio;
                    
                    // Set timeout to stop after max duration
                    soundTimeout = setTimeout(() => {
                        stopCurrentSound();
                        resolve();
                    }, duration * 1000);
                    
                    const cleanup = () => {
                        URL.revokeObjectURL(audio.src);
                        if (currentSoundInstance === audio) {
                            currentSoundInstance = null;
                        }
                    };
                    
                    audio.onended = () => {
                        cleanup();
                        stopCurrentSound();
                        resolve();
                    };
                    
                    audio.onerror = (error) => {
                        console.warn('Generated audio failed:', error);
                        cleanup();
                        stopCurrentSound();
                        reject(error);
                    };
                    
                    audio.play().catch(error => {
                        cleanup();
                        stopCurrentSound();
                        reject(error);
                    });
                    
                } catch (error) {
                    console.warn('HTML5 generated audio failed:', error);
                    stopCurrentSound();
                    reject(error);
                }
            });
        }

        function playSystemSound(soundType, maxDuration = 12) {
            let frequency;
            
            switch(soundType) {
                case 'default':
                    frequency = 800;
                    break;
                case 'chime':
                    frequency = 1200;
                    break;
                case 'ambient':
                    frequency = 400;
                    break;
                default:
                    frequency = 800;
            }
            
            // Ensure audio context is ready
            initAudioContext();
            
            // Create and play the tone (max 12 seconds)
            return createToneAudio(frequency, maxDuration, currentVolume)
                .then(() => {
                    console.log(`${soundType} sound played successfully (max ${maxDuration}s)`);
                })
                .catch((error) => {
                    console.warn(`${soundType} sound playback failed:`, error);
                    
                    // Final fallback: show visual notification
                    showGentleNotification('🔔 Gentle reminder: Take a moment for gratitude');
                });
        }

        function showGentleNotification(message) {
            // Create a gentle notification if sound fails
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-blue-500 text-white px-6 py-3 rounded-xl shadow-lg z-50 fade-in';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // STREAK TRACKER
        function initializeStreakTracker() {
            loadStreakData();
            updateStreakDisplay();
        }

        function loadStreakData() {
            const streakData = JSON.parse(localStorage.getItem('gratitudeStreak') || '{}');
            currentStreak = streakData.currentStreak || 0;
            lastGratitudeDate = streakData.lastDate || null;
        }

        function updateStreakDisplay() {
            if (!isFeatureUnlocked()) return;
            
            const streakNumber = document.getElementById('streakNumber');
            const streakMessage = document.getElementById('streakMessage');
            
            streakNumber.textContent = currentStreak;
            
            const messages = [
                "Start your gratitude journey today!",
                "Great start! Keep it up!",
                "You're building a beautiful habit!",
                "Wonderful consistency!",
                "You're on fire! 🔥",
                "Amazing dedication to gratitude!",
                "You're a gratitude champion!",
                "Incredible streak! Keep growing!"
            ];
            
            const messageIndex = Math.min(currentStreak, messages.length - 1);
            streakMessage.textContent = messages[messageIndex];
        }

        function updateStreak() {
            const today = new Date().toDateString();
            
            if (lastGratitudeDate !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (lastGratitudeDate === yesterday.toDateString()) {
                    currentStreak++;
                } else {
                    currentStreak = 1;
                }
                
                lastGratitudeDate = today;
                
                const streakData = {
                    currentStreak: currentStreak,
                    lastDate: lastGratitudeDate
                };
                
                localStorage.setItem('gratitudeStreak', JSON.stringify(streakData));
                updateStreakDisplay();
                updateStreakChart();
            }
        }

        // QUOTE ENHANCEMENTS
        function initializeQuoteEnhancements() {
            loadFavoriteQuotes();
            displayCurrentQuote();
        }

        function loadFavoriteQuotes() {
            const favorites = JSON.parse(localStorage.getItem('favoriteQuotes') || '[]');
            favoriteQuotes = new Set(favorites);
            updateFavoriteButton();
        }

        function displayCurrentQuote() {
            const quote = quotes[currentQuoteIndex];
            document.getElementById('currentQuote').textContent = `"${quote.text}"`;
            document.getElementById('currentAuthor').textContent = `— ${quote.author}`;
            updateFavoriteButton();
        }

        function shuffleQuote() {
            if (!isFeatureUnlocked()) return;
            
            currentQuoteIndex = Math.floor(Math.random() * quotes.length);
            displayCurrentQuote();
        }

        function toggleFavoriteQuote() {
            if (!isFeatureUnlocked()) return;
            
            const currentQuoteText = quotes[currentQuoteIndex].text;
            
            if (favoriteQuotes.has(currentQuoteText)) {
                favoriteQuotes.delete(currentQuoteText);
            } else {
                favoriteQuotes.add(currentQuoteText);
            }
            
            localStorage.setItem('favoriteQuotes', JSON.stringify([...favoriteQuotes]));
            updateFavoriteButton();
        }

        function updateFavoriteButton() {
            if (!isFeatureUnlocked()) return;
            
            const favoriteBtn = document.getElementById('favoriteBtn');
            const currentQuoteText = quotes[currentQuoteIndex].text;
            
            if (favoriteQuotes.has(currentQuoteText)) {
                favoriteBtn.innerHTML = '<i class="fas fa-star"></i>';
                favoriteBtn.className = 'text-yellow-500 hover:text-yellow-600 p-2';
            } else {
                favoriteBtn.innerHTML = '<i class="far fa-star"></i>';
                favoriteBtn.className = 'text-gray-400 hover:text-yellow-600 p-2';
            }
        }

        // EMOJI PICKER
        function initializeEmojiPicker() {
            const emojiPicker = document.getElementById('emojiPicker');
            const allEmojis = [...emojiSets.faces, ...emojiSets.hearts, ...emojiSets.nature];
            
            emojiPicker.innerHTML = allEmojis.map(emoji => 
                `<button class="emoji-btn" onclick="insertEmoji('${emoji}')">${emoji}</button>`
            ).join('');
        }

        function toggleEmojiPicker() {
            if (!isFeatureUnlocked()) return;
            
            const picker = document.getElementById('emojiPicker');
            picker.style.display = picker.style.display === 'none' ? 'block' : 'none';
        }

        function insertEmoji(emoji) {
            const textarea = document.getElementById('quickNoteText');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const text = textarea.value;
            
            textarea.value = text.substring(0, start) + emoji + text.substring(end);
            textarea.focus();
            textarea.setSelectionRange(start + emoji.length, start + emoji.length);
            
            document.getElementById('emojiPicker').style.display = 'none';
        }

        // SENTIMENT TRACKING
        function initializeSentimentSlider() {
            const slider = document.getElementById('sentimentSlider');
            const label = document.getElementById('sentimentLabel');
            
            const sentimentLabels = ['Very Sad', 'Sad', 'Neutral', 'Happy', 'Very Happy'];
            
            slider.addEventListener('input', function() {
                const value = parseInt(this.value);
                label.textContent = sentimentLabels[value - 1];
            });
        }

        // CLOUD SYNC
        function initializeCloudSync() {
            const syncEnabled = localStorage.getItem('cloudSyncEnabled') === 'true';
            cloudSyncEnabled = syncEnabled;
            updateSyncUI();
        }

        function toggleCloudSync() {
            if (!isFeatureUnlocked()) return;
            
            cloudSyncEnabled = !cloudSyncEnabled;
            localStorage.setItem('cloudSyncEnabled', cloudSyncEnabled);
            updateSyncUI();
            
            if (cloudSyncEnabled) {
                initializeFirebase();
            }
        }

        function updateSyncUI() {
            if (!isFeatureUnlocked()) return;
            
            const toggle = document.getElementById('syncToggle');
            const slider = document.getElementById('syncSlider');
            const status = document.getElementById('syncStatus');
            
            if (cloudSyncEnabled) {
                toggle.classList.add('bg-green-500');
                toggle.classList.remove('bg-gray-300');
                slider.style.transform = 'translateX(24px)';
                status.textContent = 'Connected';
                status.className = 'text-xs text-green-600';
            } else {
                toggle.classList.add('bg-gray-300');
                toggle.classList.remove('bg-green-500');
                slider.style.transform = 'translateX(0px)';
                status.textContent = 'Not connected';
                status.className = 'text-xs text-gray-400';
            }
        }

        function initializeFirebase() {
            // This would initialize Firebase with your config
            // For demo purposes, we'll simulate the connection
            console.log('Initializing cloud sync...');
            
            setTimeout(() => {
                const status = document.getElementById('syncStatus');
                status.textContent = 'Synced';
                status.className = 'text-xs text-blue-600';
            }, 2000);
        }

        // IMAGE ATTACHMENT
        function attachImage(input) {
            if (!isFeatureUnlocked()) return;
            
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                attachedImageData = e.target.result;
                
                const preview = document.getElementById('attachedImagePreview');
                const img = document.getElementById('attachedImage');
                
                img.src = attachedImageData;
                preview.style.display = 'flex';
            };
            reader.readAsDataURL(file);
        }

        function removeAttachedImage() {
            attachedImageData = null;
            document.getElementById('attachedImagePreview').style.display = 'none';
            document.getElementById('attachedImage').src = '';
        }

        // GRATITUDE GALLERY
        function initializeGallery() {
            displayGallery();
        }

        function displayGallery() {
            if (!isFeatureUnlocked()) return;
            
            const notes = getNotes();
            const imagesNotes = notes.filter(note => note.image);
            
            const gallery = document.getElementById('galleryGrid');
            
            if (imagesNotes.length === 0) {
                gallery.innerHTML = '<p class="text-gray-500 text-center col-span-full py-8">No images in your gratitude collection yet. Start adding photos to your reflections!</p>';
                return;
            }
            
            gallery.innerHTML = imagesNotes.map(note => `
                <div class="gallery-item" onclick="showGalleryImage('${note.image}', '${note.text}')">
                    <img src="${note.image}" alt="Gratitude moment">
                </div>
            `).join('');
        }

        function showGalleryImage(imageSrc, noteText) {
            // Create modal to show full image with note
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modal.onclick = () => document.body.removeChild(modal);
            
            modal.innerHTML = `
                <div class="max-w-2xl max-h-full bg-white rounded-xl p-6 overflow-auto">
                    <img src="${imageSrc}" class="w-full h-auto rounded-lg mb-4">
                    <p class="text-gray-700">${noteText}</p>
                    <button onclick="document.body.removeChild(this.closest('.fixed'))" class="mt-4 bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg">Close</button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // PDF EXPORT
        function exportToPDF() {
            if (!isFeatureUnlocked() || typeof jsPDF === 'undefined') return;
            
            const notes = getNotes();
            if (notes.length === 0) {
                alert('No notes to export');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Title
            doc.setFontSize(20);
            doc.text('My Gratitude Journey', 20, 20);
            
            let yPosition = 40;
            const pageHeight = doc.internal.pageSize.height;
            const margin = 20;
            
            notes.forEach((note, index) => {
                if (yPosition > pageHeight - 40) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                // Date
                doc.setFontSize(12);
                doc.setTextColor(100);
                doc.text(note.timestamp, margin, yPosition);
                yPosition += 10;
                
                // Note text
                doc.setFontSize(11);
                doc.setTextColor(0);
                const splitText = doc.splitTextToSize(note.text, 170);
                doc.text(splitText, margin, yPosition);
                yPosition += splitText.length * 5 + 10;
                
                // Add some space between entries
                yPosition += 5;
            });
            
            // Save the PDF
            doc.save('my-gratitude-journey.pdf');
        }

        // IMPORT/EXPORT
        function exportNotes() {
            const notes = getNotes();
            const dataStr = JSON.stringify(notes, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'gratitude-notes-backup.json';
            link.click();
        }

        function importNotes(input) {
            if (!isFeatureUnlocked()) return;
            
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedNotes = JSON.parse(e.target.result);
                    
                    if (!Array.isArray(importedNotes)) {
                        throw new Error('Invalid file format');
                    }
                    
                    const currentNotes = getNotes();
                    const mergedNotes = [...currentNotes, ...importedNotes];
                    
                    localStorage.setItem('gratitudeNotes', JSON.stringify(mergedNotes));
                    displayNotes();
                    displayGallery();
                    
                    alert(`Successfully imported ${importedNotes.length} notes!`);
                } catch (error) {
                    alert('Error importing notes: Invalid file format');
                }
            };
            reader.readAsText(file);
        }

        // STREAK ANALYTICS CHART
        function initializeStreakChart() {
            if (!isFeatureUnlocked() || typeof Chart === 'undefined') return;
            
            updateStreakChart();
        }

        function updateStreakChart() {
            if (!isFeatureUnlocked() || typeof Chart === 'undefined') return;
            
            const ctx = document.getElementById('streakChart');
            if (!ctx) return;
            
            // Generate sample data for the last 30 days
            const today = new Date();
            const labels = [];
            const data = [];
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                
                // Simulate some gratitude data
                data.push(Math.random() > 0.3 ? 1 : 0);
            }
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Gratitude Entries',
                        data: data,
                        backgroundColor: 'rgba(34, 197, 94, 0.8)',
                        borderColor: 'rgba(34, 197, 94, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    return value === 1 ? 'Yes' : 'No';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Your Gratitude Practice Over Time'
                        }
                    }
                }
            });
        }

        // Load upgrade state
        function loadUpgradeState() {
            if (upgradeEnabled) {
                loadUpgradePackage();
            }
        }

        // Navigation functions
        function scrollToReminders() {
            document.getElementById('reminders').scrollIntoView({ behavior: 'smooth' });
        }

        function scrollToNotes() {
            document.getElementById('notes').scrollIntoView({ behavior: 'smooth' });
            if (!notesVisible) {
                toggleNotesFolder();
            }
        }

        // ENHANCED BELL SOUND FUNCTION (12-SECOND MAX WITH KEY STOP)
        function playBellSound() {
            if (!alertsEnabled || !soundEnabled) return;
            
            const currentTime = Date.now();
            if (currentTime - lastSoundTime < 1000) return;
            lastSoundTime = currentTime;
            
            // Initialize audio context if needed
            initAudioContext();
            
            // Play system sound with 12-second maximum duration
            playSystemSound('default', 12);
        }

        // Reminder functions
        function toggleAlerts() {
            handleReminderToggle();
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            const toggle = document.getElementById('soundToggle');
            const slider = document.getElementById('soundSlider');
            const icon = document.getElementById('soundIcon');
            
            if (soundEnabled) {
                toggle.classList.add('bg-yellow-500');
                toggle.classList.remove('bg-gray-300');
                slider.style.transform = 'translateX(32px)';
                icon.classList.remove('text-gray-500');
                icon.classList.add('text-yellow-500');
                
                if (alertsEnabled) {
                    playBellSound();
                }
            } else {
                toggle.classList.add('bg-gray-300');
                toggle.classList.remove('bg-yellow-500');
                slider.style.transform = 'translateX(0px)';
                icon.classList.remove('text-yellow-500');
                icon.classList.add('text-gray-500');
            }
            
            saveSettings();
        }

        function updateSoundToggleState() {
            const soundToggle = document.getElementById('soundToggle');
            const soundIcon = document.getElementById('soundIcon');
            
            if (!alertsEnabled) {
                soundToggle.style.opacity = '0.5';
                soundToggle.style.pointerEvents = 'none';
                soundIcon.classList.remove('text-yellow-500');
                soundIcon.classList.add('text-gray-400');
            } else {
                soundToggle.style.opacity = '1';
                soundToggle.style.pointerEvents = 'auto';
                if (soundEnabled) {
                    soundIcon.classList.remove('text-gray-400');
                    soundIcon.classList.add('text-yellow-500');
                } else {
                    soundIcon.classList.remove('text-gray-400');
                    soundIcon.classList.add('text-gray-500');
                }
            }
        }

        function saveReminders() {
            try {
                const timeInputs = document.querySelectorAll('#timeInputs input[type="time"]');
                reminderTimes = [];
                
                timeInputs.forEach(input => {
                    if (input.value) {
                        reminderTimes.push(input.value);
                    }
                });
                
                saveSettings();
                
                // Setup reminders if alerts are enabled
                if (alertsEnabled) {
                    setupReminders();
                }
                
                // Enhanced visual feedback for save button
                const button = document.getElementById('saveRemindersBtn');
                const originalText = button.innerHTML;
                const originalClasses = button.className;
                
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-check mr-2"></i>Saved!';
                button.className = originalClasses.replace('bg-green-500', 'bg-green-600').replace('hover:bg-green-600', '');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.className = originalClasses;
                    button.disabled = false;
                }, 2000);
                
                console.log('Reminders saved successfully:', reminderTimes);
                
            } catch (error) {
                console.error('Error saving reminders:', error);
                
                const button = document.getElementById('saveRemindersBtn');
                const originalText = button.innerHTML;
                const originalClasses = button.className;
                
                button.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>Error!';
                button.className = originalClasses.replace('bg-green-500', 'bg-red-600').replace('hover:bg-green-600', 'hover:bg-red-700');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.className = originalClasses;
                }, 2000);
            }
        }

        function setupReminders() {
            clearAllReminders();
            
            if (!alertsEnabled || reminderTimes.length === 0) {
                console.log('Reminders not setup: alertsEnabled =', alertsEnabled, 'reminderTimes =', reminderTimes);
                return;
            }
            
            console.log('Setting up reminders for times:', reminderTimes);
            
            reminderTimes.forEach(timeStr => {
                const interval = setInterval(() => {
                    const now = new Date();
                    const currentTime = now.getHours().toString().padStart(2, '0') + ':' + 
                                      now.getMinutes().toString().padStart(2, '0');
                    
                    if (currentTime === timeStr) {
                        console.log('Reminder triggered for time:', timeStr);
                        showQuickNoteModal();
                    }
                }, 60000);
                
                reminderIntervals.push(interval);
            });
            
            console.log('Setup', reminderIntervals.length, 'reminder intervals');
        }

        function clearAllReminders() {
            reminderIntervals.forEach(interval => clearInterval(interval));
            reminderIntervals = [];
            console.log('Cleared all reminder intervals');
        }

        // Quick Note functions
        function showQuickNoteModal() {
            playBellSound();
            const modal = document.getElementById('quickNoteModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.getElementById('quickNoteText').focus();
            
            // Initialize sentiment slider if upgraded
            if (isFeatureUnlocked()) {
                initializeSentimentSlider();
            }
        }

        function closeQuickNote() {
            const modal = document.getElementById('quickNoteModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.getElementById('quickNoteText').value = '';
            
            // Reset upgrade elements
            if (isFeatureUnlocked()) {
                document.getElementById('sentimentSlider').value = 3;
                document.getElementById('sentimentLabel').textContent = 'Neutral';
                removeAttachedImage();
                document.getElementById('emojiPicker').style.display = 'none';
            }
        }

        // FIXED SAVE FUNCTION
        function saveQuickNote() {
            const noteText = document.getElementById('quickNoteText').value.trim();
            const saveBtn = document.getElementById('saveQuickNoteBtn');
            
            // Prevent multiple saves
            if (saveBtn.disabled) return;
            
            const originalText = saveBtn.innerHTML;
            const originalClasses = saveBtn.className;
            
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';
            
            // Simulate brief saving process for better UX
            setTimeout(() => {
                try {
                    // Handle empty notes gracefully
                    if (!noteText) {
                        closeQuickNote();
                        return;
                    }
                    
                    const note = {
                        id: Date.now(),
                        text: noteText,
                        timestamp: new Date().toLocaleString(),
                        selected: false
                    };
                    
                    // Add upgrade data if enabled
                    if (isFeatureUnlocked()) {
                        const sentimentValue = parseInt(document.getElementById('sentimentSlider').value);
                        note.sentiment = sentimentValue;
                        
                        if (attachedImageData) {
                            note.image = attachedImageData;
                        }
                    }
                    
                    // Save to localStorage
                    let notes = getNotes();
                    notes.unshift(note);
                    localStorage.setItem('gratitudeNotes', JSON.stringify(notes));
                    
                    // Update streak if upgrade is enabled
                    if (isFeatureUnlocked()) {
                        updateStreak();
                    }
                    
                    // Success feedback
                    saveBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Saved!';
                    saveBtn.className = originalClasses.replace('bg-blue-500', 'bg-green-500').replace('hover:bg-blue-600', 'hover:bg-green-600');
                    
                    // Complete the save process
                    setTimeout(() => {
                        // Refresh displays
                        displayNotes();
                        if (isFeatureUnlocked()) {
                            displayGallery();
                        }
                        
                        // Close modal
                        closeQuickNote();
                        
                        // Reset button
                        saveBtn.innerHTML = originalText;
                        saveBtn.className = originalClasses;
                        saveBtn.disabled = false;
                        
                        console.log('Note saved successfully:', note);
                        
                    }, 1000);
                    
                } catch (error) {
                    console.error('Error saving note:', error);
                    
                    // Error feedback
                    saveBtn.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>Failed to save';
                    saveBtn.className = originalClasses.replace('bg-blue-500', 'bg-red-500').replace('hover:bg-blue-600', 'hover:bg-red-600');
                    
                    setTimeout(() => {
                        saveBtn.innerHTML = originalText;
                        saveBtn.className = originalClasses;
                        saveBtn.disabled = false;
                    }, 2000);
                }
            }, 300);
        }

        // Notes management
        function toggleNotesFolder() {
            notesVisible = !notesVisible;
            const folder = document.getElementById('notesFolder');
            const icon = document.getElementById('folderIcon');
            
            if (notesVisible) {
                folder.style.display = 'block';
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            } else {
                folder.style.display = 'none';
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        }

        function getNotes() {
            try {
                return JSON.parse(localStorage.getItem('gratitudeNotes') || '[]');
            } catch (error) {
                console.error('Error loading notes:', error);
                return [];
            }
        }

        function displayNotes() {
            const notesList = document.getElementById('notesList');
            const clearAllContainer = document.getElementById('clearAllContainer');
            const notes = getNotes();
            
            if (notes.length === 0) {
                notesList.innerHTML = '<p class="text-gray-500 text-center py-8">No gratitude notes yet. Set up reminders to start your practice!</p>';
                clearAllContainer.style.display = 'none';
                return;
            }
            
            // Show clear all button when there are notes
            clearAllContainer.style.display = 'block';
            
            notesList.innerHTML = notes.map(note => {
                let noteHtml = `
                    <div class="note-item bg-white bg-opacity-60 p-4 rounded-xl shadow-sm" id="note-${note.id}">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                `;
                
                // Add sentiment display if available
                if (isFeatureUnlocked() && note.sentiment) {
                    const sentimentEmojis = ['😞', '😕', '😐', '🙂', '😊'];
                    noteHtml += `<div class="mb-2"><span class="text-2xl">${sentimentEmojis[note.sentiment - 1]}</span></div>`;
                }
                
                // Add image if available
                if (isFeatureUnlocked() && note.image) {
                    noteHtml += `<div class="mb-3"><img src="${note.image}" class="w-20 h-20 object-cover rounded-lg cursor-pointer" onclick="showGalleryImage('${note.image}', '${note.text}')"></div>`;
                }
                
                noteHtml += `
                                <p class="text-gray-800 mb-2">${note.text}</p>
                                <p class="text-gray-500 text-sm">${note.timestamp}</p>
                            </div>
                            <button onclick="confirmDeleteNote('${note.id}')" class="delete-btn text-red-400 hover:text-red-600 ml-3 p-2 rounded-lg transition-all">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                return noteHtml;
            }).join('');
        }

        // GENTLE NOTE DELETION FUNCTIONS
        function confirmDeleteNote(noteId) {
            const note = getNotes().find(n => n.id.toString() === noteId.toString());
            const noteText = note ? note.text.substring(0, 50) + (note.text.length > 50 ? '...' : '') : 'this note';
            
            showConfirmationModal(
                'Delete Note?',
                `Are you sure you want to delete "${noteText}"? This action cannot be undone.`,
                () => deleteNote(noteId),
                'fa-trash-alt',
                'text-red-500'
            );
        }

        function deleteNote(noteId) {
            // Add fade-out animation
            const noteElement = document.getElementById(`note-${noteId}`);
            if (noteElement) {
                noteElement.classList.add('fade-out');
                
                setTimeout(() => {
                    let notes = getNotes();
                    notes = notes.filter(note => note.id.toString() !== noteId.toString());
                    localStorage.setItem('gratitudeNotes', JSON.stringify(notes));
                    displayNotes();
                    
                    if (isFeatureUnlocked()) {
                        displayGallery();
                    }
                }, 300);
            } else {
                // Fallback if element not found
                let notes = getNotes();
                notes = notes.filter(note => note.id.toString() !== noteId.toString());
                localStorage.setItem('gratitudeNotes', JSON.stringify(notes));
                displayNotes();
                
                if (isFeatureUnlocked()) {
                    displayGallery();
                }
            }
        }

        function confirmClearAllNotes() {
            const notes = getNotes();
            const noteCount = notes.length;
            
            if (noteCount === 0) {
                showGentleNotification('No notes to delete');
                return;
            }
            
            showConfirmationModal(
                'Clear All Notes?',
                `This will permanently delete all ${noteCount} saved notes. This action cannot be undone. Are you sure you want to continue?`,
                () => clearAllNotes(),
                'fa-exclamation-triangle',
                'text-red-500'
            );
        }

        function clearAllNotes() {
            // Add fade-out animation to all notes
            const noteElements = document.querySelectorAll('.note-item');
            noteElements.forEach((element, index) => {
                setTimeout(() => {
                    element.classList.add('fade-out');
                }, index * 50); // Stagger the animations
            });
            
            setTimeout(() => {
                localStorage.setItem('gratitudeNotes', JSON.stringify([]));
                displayNotes();
                
                if (isFeatureUnlocked()) {
                    displayGallery();
                }
                
                showGentleNotification('All notes have been cleared');
            }, noteElements.length * 50 + 300);
        }

        // Storage functions
        function saveSettings() {
            try {
                const settings = {
                    alertsEnabled: alertsEnabled,
                    soundEnabled: soundEnabled,
                    upgradeEnabled: upgradeEnabled,
                    reminderTimes: reminderTimes
                };
                localStorage.setItem('gratitudeSettings', JSON.stringify(settings));
                console.log('Settings saved successfully:', settings);
            } catch (error) {
                console.error('Error saving settings:', error);
            }
        }

        function loadSettings() {
            try {
                const settings = JSON.parse(localStorage.getItem('gratitudeSettings') || '{}');
                alertsEnabled = settings.alertsEnabled || false;
                soundEnabled = settings.soundEnabled || false;
                upgradeEnabled = settings.upgradeEnabled || false;
                reminderTimes = settings.reminderTimes || [];
                
                console.log('Settings loaded:', settings);
                
                // Update notifications toggle UI
                const toggle = document.getElementById('alertToggle');
                const slider = document.getElementById('toggleSlider');
                
                if (alertsEnabled) {
                    toggle.classList.add('bg-blue-500');
                    toggle.classList.remove('bg-gray-300');
                    slider.style.transform = 'translateX(32px)';
                }
                
                // Update sound toggle UI
                const soundToggle = document.getElementById('soundToggle');
                const soundSlider = document.getElementById('soundSlider');
                const soundIcon = document.getElementById('soundIcon');
                
                if (soundEnabled) {
                    soundToggle.classList.add('bg-yellow-500');
                    soundToggle.classList.remove('bg-gray-300');
                    soundSlider.style.transform = 'translateX(32px)';
                    soundIcon.classList.remove('text-gray-500');
                    soundIcon.classList.add('text-yellow-500');
                }
                
                updateSoundToggleState();
                
                // Load time inputs
                const timeInputs = document.querySelectorAll('#timeInputs input[type="time"]');
                reminderTimes.forEach((time, index) => {
                    if (timeInputs[index]) {
                        timeInputs[index].value = time;
                    }
                });
                
                // Load volume setting
                const savedVolume = localStorage.getItem('reminderVolume') || '50';
                currentVolume = parseInt(savedVolume) / 100;
                document.getElementById('volumeSlider').value = savedVolume;
                document.getElementById('volumeValue').textContent = savedVolume + '%';
                
                // Only setup reminders if alerts are enabled
                if (alertsEnabled) {
                    setupReminders();
                }
                
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        function loadNotes() {
            try {
                localStorage.getItem('gratitudeNotes');
            } catch (e) {
                console.warn('localStorage not available');
            }
        }

        // Service Worker Registration for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                const swCode = `
                    const CACHE_NAME = 'gratitude-v1';
                    const urlsToCache = ['/'];
                    
                    self.addEventListener('install', function(event) {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(function(cache) {
                                    return cache.addAll(urlsToCache);
                                })
                        );
                    });
                    
                    self.addEventListener('fetch', function(event) {
                        event.respondWith(
                            caches.match(event.request)
                                .then(function(response) {
                                    return response || fetch(event.request);
                                }
                            )
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(function(registration) {
                        console.log('SW registered successfully');
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed');
                    });
            });
        }
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"9777c2686a6216c6","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.8.0","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDtkBJ696oyLdqDbOe2cLgA5Q2LiCfBkRNcsJ7URIovF%2F%2Fos9j0XcW1w8vlUioX79ZDM6rkYrmefDhZqcCPDel%2Fo%2Bq53GP2l7Ux1nz3yvdXK2irzJJYLBkEIB0dhT1wbnffhcPNZxGhQuiM4XKUfWwvzSzUtEWoQnYdGnCevuilvzKlyksgcL9tIU4IoBa7LJuz5zA4%2F6V%2FKMwush75CwFhqLwGEwpBnz0koLiAM7qc9mjY59DNub6VF9Sm0v1F7BCkz4atV8aUDbAxCjl2ITOAY8BzccVbJsXDQuqi6jGpPw0jmVUDQcHwq5bWDFSMFzp6f%2FkV5%2FkRoDCYvAUBYnyEc7qMDNo%2Bwn%2F%2FiVQs%2BitCf9MlDamr%2F0Wy81tWq9SB2is8V3wb6muikFEvNdOKwsz4Jo1WixSpFHY2iyhs%2BlKQN0RJtJkgvoSwaiaKYrQOilTgBRs0mvByzpvKBWmKX1NfJsj2JgqyYcSAMHkljlv%2B2%2B7pyOqWOmJxETf5BPmp6GAbE2MYi3bEISyX2bOYhOiwI%3D";
        window.__genspark_locale = "en-US";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDtkBJ696oyLdqDbOe2cLgA5Q2LiCfBkRNcsJ7URIovF//os9j0XcW1w8vlUioX79ZDM6rkYrmefDhZqcCPDel/o+q53GP2l7Ux1nz3yvdXK2irzJJYLBkEIB0dhT1wbnffhcPNZxGhQuiM4XKUfWwvzSzUtEWoQnYdGnCevuilvzKlyksgcL9tIU4IoBa7LJuz5zA4/6V/KMwush75CwFhqLwGEwpBnz0koLiAM7qc9mjY59DNub6VF9Sm0v1F7BCkz4atV8aUDbAxCjl2ITOAY8BzccVbJsXDQuqi6jGpPw0jmVUDQcHwq5bWDFSMFzp6f/kV5/kRoDCYvAUBYnyEc7qMDNo+wn//iVQs+itCf9MlDamr/0Wy81tWq9SB2is8V3wb6muikFEvNdOKwsz4Jo1WixSpFHY2iyhs+lKQN0RJtJkgvoSwaiaKYrQOilTgBRs0mvByzpvKBWmKX1NfJsj2JgqyYcSAMHkljlv+2+7pyOqWOmJxETf5BPmp6GAbE2MYi3bEISyX2bOYhOiwI=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    
