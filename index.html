<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moments of Gratitude</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#a7f3d0">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiTW9tZW50cyBvZiBHcmF0aXR1ZGUiLCJzaG9ydF9uYW1lIjoiR3JhdGl0dWRlIiwiZGVzY3JpcHRpb24iOiJDdWx0aXZhdGUgZGFpbHkgZ3JhdGl0dWRlIHRocm91Z2ggZ2VudGxlIHJlbWluZGVycyBhbmQgam91cm5hbGluZyIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZjBmZGY0IiwidGhlbWVfY29sb3IiOiIjYTdmM2QwIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbCU7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSFpwWlhkQ2IzZzlJakFnTUNBek1qQWdNekl3SWlCbWFXeHNQU0lqWVRkbU0yUXdJaUErUEdOcGNtTnNaU0JqZUQwaU1UWXdJaUJqZVQwaU1UWXdJaUJ5UFNJeE1qQWlJR1pwYkd3OUlpTXlaR056TmpBaUx6NDhkR1Y0ZENCNFBTSXhOakFpSUhrOUlqRTROVElpSUhSbGVIUXRZVzVqYUc5eVBTSnRhV1JrYkdVaUlHWnBiR3c5SWlOemJHRjBaVFkxTVNJZ1ptOXVkQzF6YVhwbFBTSXlOQ0IwWVdocGJXRWlQaUY4UEM5MFpYaDBQand2YzNabmNDNGlMQ0p6YVhwbGN5STZJakV5TUZneE1qQWlMQ0owZVhCbElqb2lhVzFoWjJVdmNHNW5JbjFkZlE9PSI+
    
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 50%, #d1fae5 100%);
        }
        
        .glass {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .modal-backdrop {
            backdrop-filter: blur(5px);
            background: rgba(0, 0, 0, 0.3);
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-gentle {
            animation: pulseGentle 2s infinite;
        }
        
        @keyframes pulseGentle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .dark {
            --tw-bg-opacity: 1;
            background-color: rgba(17, 24, 39, var(--tw-bg-opacity));
            color: #f9fafb;
        }
        
        .dark .gradient-bg {
            background: linear-gradient(135deg, #1f2937 0%, #374151 50%, #4b5563 100%);
        }
        
        .dark .glass {
            background: rgba(55, 65, 81, 0.25);
            border: 1px solid rgba(75, 85, 99, 0.18);
        }
        
        .entry-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .entry-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .notification-permission {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen transition-all duration-300">
    <!-- Navigation -->
    <nav class="glass rounded-b-lg mx-4 p-4 sticky top-0 z-50">
        <div class="flex justify-between items-center">
            <h1 class="text-2xl font-semibold text-emerald-800 flex items-center">
                <i class="fas fa-heart mr-2 text-pink-500"></i>
                Gratitude
            </h1>
            <div class="flex items-center space-x-4">
                <!-- Dark Mode Toggle (Bonus Feature - Disabled by default) -->
                <button id="darkModeToggle" class="hidden p-2 rounded-full bg-yellow-200 text-yellow-800 hover:bg-yellow-300 transition-colors">
                    <i class="fas fa-moon"></i>
                </button>
                <!-- Settings Button -->
                <button id="settingsBtn" class="p-2 rounded-full bg-emerald-200 text-emerald-800 hover:bg-emerald-300 transition-colors">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <div id="mainContainer" class="max-w-md mx-auto p-4">
        
        <!-- Welcome Section -->
        <section id="welcomeSection" class="text-center mb-8 fade-in">
            <div class="glass rounded-2xl p-6 mb-6">
                <i class="fas fa-sun text-6xl text-yellow-500 mb-4 pulse-gentle"></i>
                <h2 class="text-2xl font-semibold text-gray-800 mb-3">Welcome to Your Gratitude Journey</h2>
                <p class="text-gray-600 mb-4">Take a moment each day to appreciate life's beautiful moments. Set gentle reminders to pause, reflect, and cultivate gratitude.</p>
                
                <!-- Quote of the Day -->
                <div id="quoteOfDay" class="bg-white bg-opacity-50 rounded-lg p-4 border-l-4 border-emerald-400">
                    <p class="text-gray-700 italic" id="dailyQuote">Loading your daily inspiration...</p>
                    <p class="text-gray-500 text-sm mt-2" id="quoteAuthor"></p>
                </div>
            </div>
        </section>

        <!-- Quick Actions -->
        <section id="quickActions" class="mb-8">
            <div class="grid grid-cols-2 gap-4">
                <button id="setRemindersBtn" class="glass rounded-xl p-4 text-center hover:bg-white hover:bg-opacity-30 transition-all">
                    <i class="fas fa-clock text-3xl text-blue-500 mb-2"></i>
                    <p class="text-gray-700 font-medium">Set Reminders</p>
                </button>
                <button id="writeGratitudeBtn" class="glass rounded-xl p-4 text-center hover:bg-white hover:bg-opacity-30 transition-all">
                    <i class="fas fa-pen-fancy text-3xl text-purple-500 mb-2"></i>
                    <p class="text-gray-700 font-medium">Write Gratitude</p>
                </button>
                <button id="viewLogBtn" class="glass rounded-xl p-4 text-center hover:bg-white hover:bg-opacity-30 transition-all">
                    <i class="fas fa-book-open text-3xl text-green-500 mb-2"></i>
                    <p class="text-gray-700 font-medium">View Log</p>
                </button>
                <button id="streakBtn" class="glass rounded-xl p-4 text-center hover:bg-white hover:bg-opacity-30 transition-all hidden">
                    <i class="fas fa-fire text-3xl text-red-500 mb-2"></i>
                    <p class="text-gray-700 font-medium">Streak: <span id="streakCount">0</span></p>
                </button>
            </div>
        </section>

        <!-- Today's Gratitude Preview -->
        <section id="todayPreview" class="mb-8">
            <div class="glass rounded-xl p-4">
                <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                    <i class="fas fa-calendar-day mr-2 text-emerald-500"></i>
                    Today's Gratitude
                </h3>
                <div id="todayEntries" class="space-y-2">
                    <!-- Today's entries will be populated here -->
                </div>
                <button id="addTodayEntry" class="w-full mt-3 py-2 bg-emerald-200 text-emerald-800 rounded-lg hover:bg-emerald-300 transition-colors">
                    + Add a moment of gratitude
                </button>
            </div>
        </section>
    </div>

    <!-- Modals -->
    
    <!-- Reminder Settings Modal -->
    <div id="reminderModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
        <div class="glass rounded-2xl p-6 w-full max-w-md fade-in">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-800">Daily Reminders</h3>
                <button id="closeReminderModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <p class="text-gray-600 mb-4">Set up to 5 gentle reminders throughout your day</p>
            
            <div id="remindersList" class="space-y-3 mb-4">
                <!-- Reminder inputs will be populated here -->
            </div>
            
            <button id="addReminderBtn" class="w-full py-2 bg-blue-200 text-blue-800 rounded-lg hover:bg-blue-300 transition-colors mb-3">
                <i class="fas fa-plus mr-2"></i>Add Reminder
            </button>
            
            <div class="mb-4">
                <label class="flex items-center space-x-2">
                    <input type="checkbox" id="notificationPermission" class="rounded">
                    <span class="text-sm text-gray-600">Enable sound notifications</span>
                </label>
            </div>
            
            <button id="saveReminders" class="w-full py-3 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors">
                Save Reminders
            </button>
        </div>
    </div>

    <!-- Gratitude Prompt Modal -->
    <div id="gratitudePromptModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
        <div class="glass rounded-2xl p-6 w-full max-w-md fade-in">
            <div class="text-center mb-4">
                <i class="fas fa-heart text-4xl text-pink-500 mb-3"></i>
                <h3 class="text-xl font-semibold text-gray-800">Time for Gratitude</h3>
                <p class="text-gray-600" id="gratitudePromptText">What are you grateful for right now?</p>
            </div>
            
            <textarea id="quickGratitudeNote" class="w-full p-3 border border-gray-300 rounded-lg mb-4 resize-none" 
                      rows="3" placeholder="I'm grateful for..."></textarea>
            
            <div class="flex space-x-3">
                <button id="dismissPrompt" class="flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                    Maybe Later
                </button>
                <button id="saveQuickNote" class="flex-1 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors">
                    Save Note
                </button>
            </div>
        </div>
    </div>

    <!-- Gratitude Journal Modal -->
    <div id="journalModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
        <div class="glass rounded-2xl p-6 w-full max-w-md fade-in max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-800">Write Gratitude</h3>
                <button id="closeJournalModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">What are you grateful for?</label>
                <textarea id="gratitudeEntry" class="w-full p-3 border border-gray-300 rounded-lg resize-none" 
                          rows="4" placeholder="I'm grateful for..."></textarea>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Add tags (optional)</label>
                <input type="text" id="gratitudeTags" class="w-full p-2 border border-gray-300 rounded-lg" 
                       placeholder="family, health, friends...">
            </div>
            
            <button id="saveGratitudeEntry" class="w-full py-3 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors">
                <i class="fas fa-heart mr-2"></i>Save Gratitude
            </button>
        </div>
    </div>

    <!-- Gratitude Log Modal -->
    <div id="logModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
        <div class="glass rounded-2xl p-6 w-full max-w-md fade-in max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-800">Your Gratitude Log</h3>
                <div class="flex space-x-2">
                    <button id="exportLogBtn" class="hidden p-2 bg-blue-200 text-blue-800 rounded-lg hover:bg-blue-300 transition-colors">
                        <i class="fas fa-download"></i>
                    </button>
                    <button id="closeLogModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div id="logEntries" class="space-y-4">
                <!-- Log entries will be populated here -->
            </div>
            
            <div id="noEntries" class="text-center py-8 text-gray-500 hidden">
                <i class="fas fa-book-open text-4xl mb-3"></i>
                <p>No entries yet. Start your gratitude journey today!</p>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
        <div class="glass rounded-2xl p-6 w-full max-w-md fade-in">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-800">Settings</h3>
                <button id="closeSettingsModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <h4 class="font-medium text-gray-700 mb-2">Bonus Features</h4>
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" id="enableDarkMode" class="rounded">
                        <span class="text-sm text-gray-600">Enable Dark Mode Toggle</span>
                    </label>
                    <label class="flex items-center space-x-2 mt-2">
                        <input type="checkbox" id="enableStreak" class="rounded">
                        <span class="text-sm text-gray-600">Enable Streak Tracker</span>
                    </label>
                    <label class="flex items-center space-x-2 mt-2">
                        <input type="checkbox" id="enableExport" class="rounded">
                        <span class="text-sm text-gray-600">Enable Export Feature</span>
                    </label>
                </div>
                
                <div class="hidden" id="soundSelector">
                    <h4 class="font-medium text-gray-700 mb-2">Notification Sound</h4>
                    <select id="notificationSound" class="w-full p-2 border border-gray-300 rounded-lg">
                        <option value="bell">Gentle Bell</option>
                        <option value="chime">Wind Chime</option>
                        <option value="tone">Soft Tone</option>
                    </select>
                </div>
                
                <button id="clearAllData" class="w-full py-2 bg-red-200 text-red-800 rounded-lg hover:bg-red-300 transition-colors">
                    Clear All Data
                </button>
            </div>
        </div>
    </div>

    <script>
        // App State
        const appState = {
            reminders: [],
            gratitudeEntries: [],
            settings: {
                darkMode: false,
                streakEnabled: false,
                exportEnabled: false,
                notificationSound: 'bell'
            },
            currentStreak: 0,
            lastEntryDate: null
        };

        // Quotes array for daily inspiration
        const gratitudeQuotes = [
            { quote: "Gratitude turns what we have into enough.", author: "Anonymous" },
            { quote: "Be thankful for what you have; you'll end up having more.", author: "Oprah Winfrey" },
            { quote: "Gratitude is not only the greatest of virtues, but the parent of all others.", author: "Cicero" },
            { quote: "The more grateful I am, the more beauty I see.", author: "Mary Davis" },
            { quote: "Gratitude makes sense of our past, brings peace for today, and creates a vision for tomorrow.", author: "Melody Beattie" },
            { quote: "When we focus on our gratitude, the tide of disappointment goes out and the tide of love rushes in.", author: "Kristin Armstrong" },
            { quote: "Gratitude is the healthiest of all human emotions.", author: "Zig Ziglar" },
            { quote: "As we express our gratitude, we must never forget that the highest appreciation is not to utter words, but to live by them.", author: "John F. Kennedy" }
        ];

        const gratitudePrompts = [
            "What made you smile today?",
            "Who are you grateful for in your life?",
            "What's something beautiful you noticed today?",
            "What challenge helped you grow recently?",
            "What small pleasure brought you joy?",
            "What are you looking forward to?",
            "What's something about your body you're grateful for?",
            "What opportunity are you thankful for?",
            "What lesson are you grateful to have learned?",
            "What aspect of nature fills you with wonder?"
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadAppState();
            setupEventListeners();
            displayDailyQuote();
            updateTodayPreview();
            setupNotificationCheck();
            
            // Register service worker for PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('data:application/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4geyBldmVudC53YWl0VW50aWwoc2VsZi5za2lwV2FpdGluZygpKTsgfSk7IHNlbGYuYWRkRXZlbnRMaXN0ZW5lcignYWN0aXZhdGUnLCBldmVudCA9PiB7IGV2ZW50LndhaXRVbnRpbChzZWxmLmNsaWVudHMuY2xhaW0oKSk7IH0pOw==');
            }
        });

        function setupEventListeners() {
            // Navigation buttons
            document.getElementById('setRemindersBtn').addEventListener('click', () => openModal('reminderModal'));
            document.getElementById('writeGratitudeBtn').addEventListener('click', () => openModal('journalModal'));
            document.getElementById('viewLogBtn').addEventListener('click', () => openModal('logModal'));
            document.getElementById('settingsBtn').addEventListener('click', () => openModal('settingsModal'));

            // Modal close buttons
            document.getElementById('closeReminderModal').addEventListener('click', () => closeModal('reminderModal'));
            document.getElementById('closeJournalModal').addEventListener('click', () => closeModal('journalModal'));
            document.getElementById('closeLogModal').addEventListener('click', () => closeModal('logModal'));
            document.getElementById('closeSettingsModal').addEventListener('click', () => closeModal('settingsModal'));

            // Reminder management
            document.getElementById('addReminderBtn').addEventListener('click', addReminderInput);
            document.getElementById('saveReminders').addEventListener('click', saveReminders);

            // Gratitude journal
            document.getElementById('saveGratitudeEntry').addEventListener('click', saveGratitudeEntry);
            document.getElementById('addTodayEntry').addEventListener('click', () => openModal('journalModal'));

            // Gratitude prompt
            document.getElementById('dismissPrompt').addEventListener('click', () => closeModal('gratitudePromptModal'));
            document.getElementById('saveQuickNote').addEventListener('click', saveQuickNote);

            // Settings
            document.getElementById('enableDarkMode').addEventListener('change', toggleDarkModeFeature);
            document.getElementById('enableStreak').addEventListener('change', toggleStreakFeature);
            document.getElementById('enableExport').addEventListener('change', toggleExportFeature);
            document.getElementById('clearAllData').addEventListener('click', clearAllData);

            // Dark mode toggle
            document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);

            // Export functionality
            document.getElementById('exportLogBtn').addEventListener('click', exportGratitudeLog);

            // Close modals on backdrop click
            document.querySelectorAll('[id$="Modal"]').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal(modal.id);
                    }
                });
            });
        }

        function loadAppState() {
            const saved = localStorage.getItem('momentsOfGratitude');
            if (saved) {
                Object.assign(appState, JSON.parse(saved));
                applySettings();
                setupReminders();
            }
        }

        function saveAppState() {
            localStorage.setItem('momentsOfGratitude', JSON.stringify(appState));
        }

        function applySettings() {
            // Apply dark mode
            if (appState.settings.darkMode) {
                document.body.classList.add('dark');
            }

            // Show/hide bonus features
            document.getElementById('darkModeToggle').classList.toggle('hidden', !appState.settings.darkMode);
            document.getElementById('streakBtn').classList.toggle('hidden', !appState.settings.streakEnabled);
            document.getElementById('exportLogBtn').classList.toggle('hidden', !appState.settings.exportEnabled);

            // Update settings checkboxes
            document.getElementById('enableDarkMode').checked = appState.settings.darkMode;
            document.getElementById('enableStreak').checked = appState.settings.streakEnabled;
            document.getElementById('enableExport').checked = appState.settings.exportEnabled;

            // Update streak display
            if (appState.settings.streakEnabled) {
                document.getElementById('streakCount').textContent = appState.currentStreak;
            }
        }

        function displayDailyQuote() {
            const today = new Date().toDateString();
            const quoteIndex = new Date().getDate() % gratitudeQuotes.length;
            const quote = gratitudeQuotes[quoteIndex];
            
            document.getElementById('dailyQuote').textContent = `"${quote.quote}"`;
            document.getElementById('quoteAuthor').textContent = `— ${quote.author}`;
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
            
            if (modalId === 'reminderModal') {
                populateReminderInputs();
            } else if (modalId === 'logModal') {
                populateGratitudeLog();
            } else if (modalId === 'gratitudePromptModal') {
                populateGratitudePrompt();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            
            // Clear form inputs
            if (modalId === 'journalModal') {
                document.getElementById('gratitudeEntry').value = '';
                document.getElementById('gratitudeTags').value = '';
            } else if (modalId === 'gratitudePromptModal') {
                document.getElementById('quickGratitudeNote').value = '';
            }
        }

        function populateReminderInputs() {
            const container = document.getElementById('remindersList');
            container.innerHTML = '';
            
            appState.reminders.forEach((reminder, index) => {
                addReminderInput(reminder.time, index);
            });
        }

        function addReminderInput(time = '', index = -1) {
            if (appState.reminders.length >= 5 && index === -1) {
                alert('You can set up to 5 reminders');
                return;
            }

            const container = document.getElementById('remindersList');
            const reminderDiv = document.createElement('div');
            reminderDiv.className = 'flex items-center space-x-2';
            reminderDiv.innerHTML = `
                <input type="time" class="flex-1 p-2 border border-gray-300 rounded-lg" value="${time}">
                <button class="p-2 bg-red-200 text-red-800 rounded-lg hover:bg-red-300 transition-colors" onclick="removeReminderInput(this)">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(reminderDiv);
        }

        function removeReminderInput(button) {
            button.parentElement.remove();
        }

        function saveReminders() {
            const inputs = document.querySelectorAll('#remindersList input[type="time"]');
            appState.reminders = Array.from(inputs)
                .map(input => ({ time: input.value, enabled: true }))
                .filter(reminder => reminder.time);

            saveAppState();
            setupReminders();
            closeModal('reminderModal');
            
            // Request notification permission if reminders are set
            if (appState.reminders.length > 0 && 'Notification' in window) {
                Notification.requestPermission();
            }
        }

        function setupReminders() {
            // Clear existing intervals
            if (window.reminderIntervals) {
                window.reminderIntervals.forEach(interval => clearInterval(interval));
            }
            window.reminderIntervals = [];

            appState.reminders.forEach(reminder => {
                const checkTime = () => {
                    const now = new Date();
                    const reminderTime = reminder.time.split(':');
                    const reminderHour = parseInt(reminderTime[0]);
                    const reminderMinute = parseInt(reminderTime[1]);

                    if (now.getHours() === reminderHour && now.getMinutes() === reminderMinute && now.getSeconds() === 0) {
                        triggerGratitudeReminder();
                    }
                };

                const interval = setInterval(checkTime, 1000);
                window.reminderIntervals.push(interval);
            });
        }

        function triggerGratitudeReminder() {
            // Play notification sound
            playNotificationSound();
            
            // Show gratitude prompt modal
            openModal('gratitudePromptModal');

            // Show browser notification if permission granted
            if (Notification.permission === 'granted') {
                new Notification('Time for Gratitude', {
                    body: 'Take a moment to reflect on what you\'re grateful for',
                    icon: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMjAgMzIwIiBmaWxsPSIjYTdmM2QwIj4KPGNpcmNsZSBjeD0iMTYwIiBjeT0iMTYwIiByPSIxMjAiIGZpbGw9IiMyZGM2NTMiLz4KPHRleHQgeD0iMTYwIiB5PSIxODUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiNzbGF0ZTY1MSIgZm9udC1zaXplPSIyNCB0YWhvbWEiPuKdpDwvdGV4dD4KPC9zdmc+'
                });
            }
        }

        function populateGratitudePrompt() {
            const promptIndex = Math.floor(Math.random() * gratitudePrompts.length);
            document.getElementById('gratitudePromptText').textContent = gratitudePrompts[promptIndex];
        }

        function saveQuickNote() {
            const note = document.getElementById('quickGratitudeNote').value.trim();
            if (note) {
                addGratitudeEntry(note, '');
                closeModal('gratitudePromptModal');
            }
        }

        function saveGratitudeEntry() {
            const entry = document.getElementById('gratitudeEntry').value.trim();
            const tags = document.getElementById('gratitudeTags').value.trim();
            
            if (entry) {
                addGratitudeEntry(entry, tags);
                closeModal('journalModal');
                updateTodayPreview();
            }
        }

        function addGratitudeEntry(content, tags) {
            const entry = {
                id: Date.now(),
                content: content,
                tags: tags.split(',').map(tag => tag.trim()).filter(tag => tag),
                timestamp: new Date(),
                date: new Date().toDateString()
            };

            appState.gratitudeEntries.unshift(entry);
            updateStreak();
            saveAppState();
            
            // Show success feedback
            showToast('Gratitude saved! 💚');
        }

        function updateStreak() {
            const today = new Date().toDateString();
            const yesterday = new Date(Date.now() - 86400000).toDateString();
            
            if (appState.lastEntryDate === today) {
                return; // Already counted today
            }
            
            if (appState.lastEntryDate === yesterday || !appState.lastEntryDate) {
                appState.currentStreak += 1;
            } else {
                appState.currentStreak = 1;
            }
            
            appState.lastEntryDate = today;
            
            if (appState.settings.streakEnabled) {
                document.getElementById('streakCount').textContent = appState.currentStreak;
            }
        }

        function updateTodayPreview() {
            const today = new Date().toDateString();
            const todayEntries = appState.gratitudeEntries.filter(entry => entry.date === today);
            const container = document.getElementById('todayEntries');
            
            container.innerHTML = '';
            
            if (todayEntries.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">No entries yet today</p>';
            } else {
                todayEntries.forEach(entry => {
                    const entryDiv = document.createElement('div');
                    entryDiv.className = 'bg-white bg-opacity-50 rounded-lg p-3 text-sm';
                    entryDiv.innerHTML = `
                        <p class="text-gray-700">${entry.content}</p>
                        <p class="text-gray-500 text-xs mt-1">${new Date(entry.timestamp).toLocaleTimeString()}</p>
                    `;
                    container.appendChild(entryDiv);
                });
            }
        }

        function populateGratitudeLog() {
            const container = document.getElementById('logEntries');
            const noEntries = document.getElementById('noEntries');
            
            container.innerHTML = '';
            
            if (appState.gratitudeEntries.length === 0) {
                noEntries.classList.remove('hidden');
                return;
            }
            
            noEntries.classList.add('hidden');
            
            // Group entries by date
            const entriesByDate = {};
            appState.gratitudeEntries.forEach(entry => {
                if (!entriesByDate[entry.date]) {
                    entriesByDate[entry.date] = [];
                }
                entriesByDate[entry.date].push(entry);
            });
            
            Object.keys(entriesByDate).forEach(date => {
                const dateSection = document.createElement('div');
                dateSection.className = 'mb-4';
                
                const dateHeader = document.createElement('h4');
                dateHeader.className = 'font-medium text-gray-700 mb-2 flex items-center';
                dateHeader.innerHTML = `<i class="fas fa-calendar-alt mr-2 text-emerald-500"></i>${formatDate(date)}`;
                dateSection.appendChild(dateHeader);
                
                entriesByDate[date].forEach(entry => {
                    const entryDiv = document.createElement('div');
                    entryDiv.className = 'entry-card bg-white bg-opacity-50 rounded-lg p-3 mb-2';
                    entryDiv.innerHTML = `
                        <p class="text-gray-700 mb-2">${entry.content}</p>
                        <div class="flex justify-between items-center">
                            <div class="flex flex-wrap gap-1">
                                ${entry.tags.map(tag => `<span class="bg-emerald-200 text-emerald-800 text-xs px-2 py-1 rounded-full">${tag}</span>`).join('')}
                            </div>
                            <span class="text-gray-500 text-xs">${new Date(entry.timestamp).toLocaleTimeString()}</span>
                        </div>
                    `;
                    dateSection.appendChild(entryDiv);
                });
                
                container.appendChild(dateSection);
            });
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const today = new Date().toDateString();
            const yesterday = new Date(Date.now() - 86400000).toDateString();
            
            if (dateString === today) return 'Today';
            if (dateString === yesterday) return 'Yesterday';
            
            return date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function toggleDarkModeFeature() {
            appState.settings.darkMode = document.getElementById('enableDarkMode').checked;
            document.getElementById('darkModeToggle').classList.toggle('hidden', !appState.settings.darkMode);
            saveAppState();
        }

        function toggleStreakFeature() {
            appState.settings.streakEnabled = document.getElementById('enableStreak').checked;
            document.getElementById('streakBtn').classList.toggle('hidden', !appState.settings.streakEnabled);
            if (appState.settings.streakEnabled) {
                document.getElementById('streakCount').textContent = appState.currentStreak;
            }
            saveAppState();
        }

        function toggleExportFeature() {
            appState.settings.exportEnabled = document.getElementById('enableExport').checked;
            document.getElementById('exportLogBtn').classList.toggle('hidden', !appState.settings.exportEnabled);
            saveAppState();
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark');
            const isDark = document.body.classList.contains('dark');
            const icon = document.querySelector('#darkModeToggle i');
            icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
        }

        function exportGratitudeLog() {
            let exportText = 'My Gratitude Journey\n\n';
            
            const entriesByDate = {};
            appState.gratitudeEntries.forEach(entry => {
                if (!entriesByDate[entry.date]) {
                    entriesByDate[entry.date] = [];
                }
                entriesByDate[entry.date].push(entry);
            });
            
            Object.keys(entriesByDate).forEach(date => {
                exportText += `${formatDate(date)}\n`;
                exportText += '='.repeat(formatDate(date).length) + '\n\n';
                
                entriesByDate[date].forEach(entry => {
                    exportText += `${new Date(entry.timestamp).toLocaleTimeString()}: ${entry.content}\n`;
                    if (entry.tags.length > 0) {
                        exportText += `Tags: ${entry.tags.join(', ')}\n`;
                    }
                    exportText += '\n';
                });
                
                exportText += '\n';
            });
            
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `gratitude-log-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Gratitude log exported! 📄');
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all your gratitude data? This cannot be undone.')) {
                localStorage.removeItem('momentsOfGratitude');
                location.reload();
            }
        }

        function playNotificationSound() {
            // Create a gentle notification sound using Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Create a gentle bell-like sound
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.5);
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log('Audio not supported');
            }
        }

        function setupNotificationCheck() {
            // Check for notification permission
            if ('Notification' in window) {
                document.getElementById('notificationPermission').checked = Notification.permission === 'granted';
                document.getElementById('notificationPermission').addEventListener('change', (e) => {
                    if (e.target.checked && Notification.permission !== 'granted') {
                        Notification.requestPermission().then(permission => {
                            e.target.checked = permission === 'granted';
                        });
                    }
                });
            }
        }

        function showToast(message) {
            // Simple toast notification
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-emerald-500 text-white px-4 py-2 rounded-lg z-50 fade-in';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Streak button click handler
        document.addEventListener('click', (e) => {
            if (e.target.closest('#streakBtn')) {
                showToast(`You're on a ${appState.currentStreak} day streak! Keep it up! 🔥`);
            }
        });

        // Auto-save on page unload
        window.addEventListener('beforeunload', saveAppState);
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDmEhItA19aFnK1zpLlQF%2Fq0jnSi9Oqj%2BJtjhxr5DjcgHLyZGXFvFElsFuFoziVG0H2MqKMs4NAR2ywYakkzUGXxCTPKECCE3HZWDsoz2s8%2FIKPsVC7SeeoZZwPucBMKt4ZqHjb0ILzQAdol%2Bens8YaeejK6kFVpU3kyYFiDZ6ZaiyDJ0x8ql1EoJeqLEBUyy5eUZ5a8%2Bo0Orn8vb4tOfj%2FQYXAv9gZDNCgNNOdRQqU%2BR3SuA7AiN8E8Wqa24sCzpB25e8JkvKx56OsBZ2SwFByhhqWUFblgTKcrlaVwXHeZLXIvKYeWT1tkvq4GWrDFW6FZk3gNOLFPmiaqRR1TuN%2BZPKlNgE%2FqT2jvr1rfAvaqQKJ%2BML1dp%2FlVQo2uMSOdWFIysZQ91Y%2Fb8PvHPl6NYZE44%2FX%2F%2Fxvm7Md3midgBTp%2F1KoU%2FQOyxBqxWh0ytTodVsBigWw4aFbJrawrz6f2vnxTq5upgQ8YqH4x0E1C%2FS41yW%2FiILT6CHoN6Bf84c5WyVg%3D%3D";
        window.__genspark_locale = "en-US";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDmEhItA19aFnK1zpLlQF/q0jnSi9Oqj+Jtjhxr5DjcgHLyZGXFvFElsFuFoziVG0H2MqKMs4NAR2ywYakkzUGXxCTPKECCE3HZWDsoz2s8/IKPsVC7SeeoZZwPucBMKt4ZqHjb0ILzQAdol+ens8YaeejK6kFVpU3kyYFiDZ6ZaiyDJ0x8ql1EoJeqLEBUyy5eUZ5a8+o0Orn8vb4tOfj/QYXAv9gZDNCgNNOdRQqU+R3SuA7AiN8E8Wqa24sCzpB25e8JkvKx56OsBZ2SwFByhhqWUFblgTKcrlaVwXHeZLXIvKYeWT1tkvq4GWrDFW6FZk3gNOLFPmiaqRR1TuN+ZPKlNgE/qT2jvr1rfAvaqQKJ+ML1dp/lVQo2uMSOdWFIysZQ91Y/b8PvHPl6NYZE44/X//xvm7Md3midgBTp/1KoU/QOyxBqxWh0ytTodVsBigWw4aFbJrawrz6f2vnxTq5upgQ8YqH4x0E1C/S41yW/iILT6CHoN6Bf84c5WyVg==";
    </script>
    
        <script id="html_badge_script2" src="https://www.genspark.ai/html_badge.js"></script>
        
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    <script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"96f4cf4818c886f8","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.8.0","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
